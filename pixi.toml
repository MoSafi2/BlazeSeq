[workspace]
name = "blazeseq"
version = "0.2.0"
description = "Primitives for FASTQ parsing and GPU-accelerated sequencing utilities in Mojo."
authors = []
channels = ["conda-forge", "https://conda.modular.com/max-nightly"]
platforms = ["linux-64", "osx-arm64"]
license = "MIT"
preview = ["pixi-build"]

[package]
name = "blazeseq"
version = "0.2.0"

[package.build]
backend = { name = "pixi-build-mojo", version = "0.*", channels = [
    "https://prefix.dev/pixi-build-backends",
    "https://prefix.dev/conda-forge",
] }

[package.host-dependencies]
mojo-compiler = "=0.26.1.0"

[package.build-dependencies]
mojo-compiler = "=0.26.1.0"
rattler-build = "*"

[package.run-dependencies]
mojo-compiler = "=0.26.1.0"

[dependencies]
mojo = "=0.26.1.0"
nodejs = ">=20"

[tasks]
build = "mojo package blazeseq -o BlazeSeq.mojopkg"
test = { cmd = "sh -c 'find ./tests -name test_*.mojo | xargs -I % pixi run mojo run -I . -D ASSERT=all %'" } # test
docs = "modo build && cd docs/site && npm install && node scripts/add-frontmatter.mjs && npm run build"
docs-serve = "modo build && cd docs/site && npm install && node scripts/add-frontmatter.mjs && npm run dev"
rbuild = "pixi build"
rtest = { cmd = "sh -c 'PKG=$(ls ./blazeseq*.conda 2>/dev/null || find .pixi/build -name \"blazeseq*.conda\" -type f 2>/dev/null | head -1); test -n \"$PKG\" && rattler-build test -c conda-forge -c https://conda.modular.com/max --package-file \"$PKG\"'", depends-on = [
    "rbuild",
] }

[pypi-dependencies]
pymodo = ">=0.11.12, <0.12"

# Benchmark environment: tools for run_benchmarks.sh (hyperfine, Rust).
# Julia is not in conda-forge for all platforms; install from https://julialang.org and ensure it is on PATH.
# Install with: pixi install -e benchmark
# Run benchmarks with: pixi run -e benchmark ./benchmark/fastq-parser/run_benchmarks.sh
[feature.benchmark.dependencies]
hyperfine = "*"
rust = "*"

[feature.benchmark.tasks]
# Run the full benchmark suite (run: pixi install -e benchmark, then this task)
benchmark = "bash -c './benchmark/fastq-parser/run_benchmarks.sh'"

[environments]
benchmark = ["default", "benchmark"]
